<h1>Productos</h1>

<div class="products">
  {{#each payload}}
    <div class="product-card">
      <h3>{{this.title}}</h3>
      <img src="{{this.thumbnails.[0]}}" alt="{{this.title}}" style="width:120px;height:120px"/>
      <p>{{this.description}}</p>
      <p>Precio: ${{this.price}}</p>
      <p>Categoria: {{this.category}}</p>
      <p>Stock: {{this.stock}}</p>

      <!-- Ver detalles -->
      <a href="/products/{{this._id}}">Ver</a>

      <!-- Agregar al carrito (ejemplo con fetch, requiere cartId conocida o sesi칩n) -->
      <button class="add-to-cart-btn" data-id="{{this._id}}">Agregar al carrito</button>
    </div>
  {{/each}}
</div>

<nav class="pagination">
  {{#if hasPrevPage}}
    <a href="{{prevLink}}">Anterior</a>
  {{/if}}

  P치gina {{page}} de {{totalPages}}

  {{#if hasNextPage}}
    <a href="{{nextLink}}">Siguiente</a>
  {{/if}}
</nav>

<script>
  document.querySelectorAll('.add-to-cart-btn').forEach(btn=>{
    btn.addEventListener('click', async (e)=>{
      const pid = btn.dataset.id;
      // si sabes el cartId desde sesi칩n o variable global:
      const cartId = window.CURRENT_CART_ID || 'aqui-tu-cart-id'; // reemplazar
      try {
        const resp = await fetch(`/api/carts/${cartId}/products/${pid}`, {
          method: 'POST', // implementa endpoint para add product
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ quantity: 1 })
        });
        const json = await resp.json();
        if(json.status === 'success') alert('Producto agregado!');
        else alert('Error: ' + (json.message || ''));
      } catch (err) {
        console.error(err);
        alert('Error a침adiendo al carrito');
      }
    });
  });
</script>
